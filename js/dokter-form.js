var poliData = {
    poliumum: [
        {
            nama: "dr.Rudi Setiawan",
            spesialisasi: "Dokter Umum",
            exp: "5 Tahun",
            like: "90%",
            ppimg: "../image/Dokter Umum/dokter-umum-1.png",
            jadwal: [
                ["Senin", "08.00-12.00"],
                ["Selasa", "08.00-12.00"],
                ["Rabu", "08.00-12.00"],
                ["Kamis", "17.00-21.00"]
            ]
        },
        {
            nama: "dr.Dewi Handayani",
            spesialisasi: "Dokter Umum",
            exp: "3 Tahun",
            like: "98%",
            ppimg: "../image/Dokter Umum/dokter-umum-2.png",
            jadwal: [
                ["Senin", "13.00-17.00"],
                ["Selasa", "13.00-17.00"],
                ["Rabu", "13.00-17.00"],
                ["Jumat", "17.00-21.00"]
            ]
        },
        {
            nama: "dr.Aditya Prabowo",
            spesialisasi: "Dokter Umum",
            exp: "12 Tahun",
            like: "89%",
            ppimg: "../image/Dokter Umum/dokter-umum-3.png",
            jadwal: [
                ["Senin", "17.00-21.00"],
                ["Selasa", "17.00-21.00"],
                ["Rabu", "17.00-21.00"]
            ]
        },
        {
            nama: "dr.Hendra Wijaya",
            spesialisasi: "Dokter Umum",
            exp: "8 Tahun",
            like: "87%",
            ppimg: "../image/Dokter Umum/dokter-umum-4.png",
            jadwal: [
                ["Kamis", "08.00-12.00"],
                ["Jumat", "08.00-12.00"]
            ]
        },
        {
            nama: "dr.Yulia Safitri",
            spesialisasi: "Dokter Umum",
            exp: "10 Tahun",
            like: "89%",
            ppimg: "../image/Dokter Umum/dokter-umum-5.png",
            jadwal: [
                ["Kamis", "13.00-17.00"],
                ["Jumat", "13.00-17.00"]
            ]
        }
    ],
    poligigi: [
        {
            nama: "dr. Budi Prasetyo, Sp.Ort",
            spesialisasi: "Spesialis Ortodonti",
            exp: "5 Tahun",
            like: "85%",
            ppimg: "../image/Dokter spesialis/dokter-gigi-1.png",
            jadwal: [
                ["Senin", "08.00-12.00"],
                ["Selasa", "08.00-12.00"],
                ["Rabu", "08.00-12.00"],
                ["Kamis", "08.00-12.00"],
                ["Jumat", "08.00-12.00"]
            ]
        },
        {
            nama: "dr. Siti Rahayu, Sp.Perio",
            spesialisasi: "Spesialis Periodonti",
            exp: "6 Tahun",
            like: "92%",
            ppimg: "../image/Dokter spesialis/dokter-gigi-2.png",
            jadwal: [
                ["Senin", "13.00-17.00"],
                ["Selasa", "13.00-17.00"],
                ["Rabu", "13.00-17.00"],
                ["Kamis", "13.00-17.00"],
                ["Jumat", "13.00-17.00"]
            ]
        },
        {
            nama: "dr. Andi Wibowo, Sp.Pros",
            spesialisasi: "Spesialis Prostodonti",
            exp: "12 Tahun",
            like: "98%",
            ppimg: "../image/Dokter spesialis/dokter-gigi-3.png",
            jadwal: [
                ["Senin", "17.00-21.00"],
                ["Selasa", "17.00-21.00"],
                ["Rabu", "17.00-21.00"],
                ["Kamis", "17.00-21.00"],
                ["Jumat", "17.00-21.00"]
            ]
        }
    ],
    polianak: [
        {
            nama: "dr. Anisa Indriani, Sp.A",
            spesialisasi: "Spesialis Anak",
            exp: "4 Tahun",
            like: "95%",
            ppimg: "../image/Dokter spesialis/dokter-anak-1.png",
            jadwal: [
                ["Senin", "08.00-12.00"],
                ["Selasa", "08.00-12.00"],
                ["Rabu", "08.00-12.00"],
                ["Kamis", "08.00-12.00"],
                ["Jumat", "08.00-12.00"]
            ]
        },
        {
            nama: "dr. Dian Purnama, Sp.KJ",
            spesialisasi: "Spesialis Kesehatan Jiwa",
            exp: "7 Tahun",
            like: "90%",
            ppimg: "../image/Dokter spesialis/dokter-anak-2.png",
            jadwal: [
                ["Senin", "13.00-17.00"],
                ["Selasa", "13.00-17.00"],
                ["Rabu", "13.00-17.00"],
                ["Kamis", "13.00-17.00"],
                ["Jumat", "13.00-17.00"]
            ]
        },
        {
            nama: "dr. Rini Cahyati, Sp.THT-KL",
            spesialisasi: "Spesialis Telinga Hidung Tenggorokan-Kepala Leher",
            exp: "5 Tahun",
            like: "93%",
            ppimg: "../image/Dokter spesialis/dokter-anak-3.png",
            jadwal: [
                ["Senin", "17.00-21.00"],
                ["Selasa", "17.00-21.00"],
                ["Rabu", "17.00-21.00"],
                ["Kamis", "17.00-21.00"],
                ["Jumat", "17.00-21.00"]
            ]
        }
    ],
    polipdalam: [
        {
            nama: "dr. Tri Haryanto, Sp.PD",
            spesialisasi: "Spesialis Penyakit Dalam",
            exp: "9 Tahun",
            like: "96%",
            ppimg: "../image/Dokter spesialis/dokter-penyakitdalam-1.png",
            jadwal: [
                ["Senin", "08.00-12.00"],
                ["Selasa", "08.00-12.00"],
                ["Rabu", "08.00-12.00"],
                ["Kamis", "08.00-12.00"],
                ["Jumat", "08.00-12.00"]
            ]
        },
        {
            nama: "dr. Rina Wijaya, Sp.GK",
            spesialisasi: "Spesialis Gizi Klinis",
            exp: "12 Tahun",
            like: "94%",
            ppimg: "../image/Dokter spesialis/dokter-penyakitdalam-2.png",
            jadwal: [
                ["Senin", "13.00-17.00"],
                ["Selasa", "13.00-17.00"],
                ["Rabu", "13.00-17.00"],
                ["Kamis", "13.00-17.00"],
                ["Jumat", "13.00-17.00"]
            ]
        },
        {
            nama: "dr. Siti Rahmawati, Sp.PD",
            spesialisasi: "Spesialis Penyakit Dalam",
            exp: "5 Tahun",
            like: "88%",
            ppimg: "../image/Dokter spesialis/dokter-penyakitdalam-3.png",
            jadwal: [
                ["Senin", "17.00-21.00"],
                ["Selasa", "17.00-21.00"],
                ["Rabu", "17.00-21.00"],
                ["Kamis", "17.00-21.00"],
                ["Jumat", "17.00-21.00"]
            ]
        }
    ],
    polimata: [
        {
            nama: "dr. Adi Nugraha, Sp.M",
            spesialisasi: "Spesialis Mata",
            exp: "9 Tahun",
            like: "87%",
            ppimg: "../image/Dokter spesialis/dokter-mata-1.png",
            jadwal: [
                ["Senin", "08.00-12.00"],
                ["Selasa", "08.00-12.00"],
                ["Rabu", "08.00-12.00"],
                ["Kamis", "08.00-12.00"],
                ["Jumat", "08.00-12.00"]
            ]
        },
        {
            nama: "dr. Maya Dewi, Sp.PA",
            spesialisasi: "Spesialis Patologi Anatomi",
            exp: "7 Tahun",
            like: "90%",
            ppimg: "../image/Dokter spesialis/dokter-mata-2.png",
            jadwal: [
                ["Senin", "13.00-17.00"],
                ["Selasa", "13.00-17.00"],
                ["Rabu", "13.00-17.00"],
                ["Kamis", "13.00-17.00"],
                ["Jumat", "13.00-17.00"]
            ]
        },
        {
            nama: "dr. Iwan Setiawan, Sp.M",
            spesialisasi: "Spesialis Mata",
            exp: "15 Tahun",
            like: "98%",
            ppimg: "../image/Dokter spesialis/dokter-mata-3.png",
            jadwal: [
                ["Senin", "17.00-21.00"],
                ["Selasa", "17.00-21.00"],
                ["Rabu", "17.00-21.00"],
                ["Kamis", "17.00-21.00"],
                ["Jumat", "17.00-21.00"]
            ]
        }
    ],
    polijantung: [
        {
            nama: "dr. Agus Santoso, Sp.JP",
            spesialisasi: "Spesialis Jantung dan Pembuluh Darah",
            exp: "22 Tahun",
            like: "94%",
            ppimg: "../image/Dokter spesialis/dokter-jantung-1.png",
            jadwal: [
                ["Senin", "08.00-12.00"],
                ["Selasa", "08.00-12.00"],
                ["Rabu", "08.00-12.00"],
                ["Kamis", "08.00-12.00"],
                ["Jumat", "08.00-12.00"]
            ]
        },
        {
            nama: "dr. Indah Wulandari, Sp.JP",
            spesialisasi: "Spesialis Jantung dan Pembuluh Darah",
            exp: "13 Tahun",
            like: "95%",
            ppimg: "../image/Dokter spesialis/dokter-jantung-2.png",
            jadwal: [
                ["Senin", "13.00-17.00"],
                ["Selasa", "13.00-17.00"],
                ["Rabu", "13.00-17.00"],
                ["Kamis", "13.00-17.00"],
                ["Jumat", "13.00-17.00"]
            ]
        },
        {
            nama: "dr. Yudi Pranata, Sp.BP",
            spesialisasi: "Spesialis Bedah Jantung dan Pembuluh Darah",
            exp: "18 Tahun",
            like: "98%",
            ppimg: "../image/Dokter spesialis/dokter-jantung-3.png",
            jadwal: [
                ["Senin", "17.00-21.00"],
                ["Selasa", "17.00-21.00"],
                ["Rabu", "17.00-21.00"],
                ["Kamis", "17.00-21.00"],
                ["Jumat", "17.00-21.00"]
            ]
        }
    ]
};


function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
    results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
}

function tampilkanDokter(poliId) {
    poliData[poliId].forEach(function(dokter) {
        var dokterElement = document.createElement("div");
        dokterElement.className = "dokter-container";
        dokterElement.innerHTML = `
            <img id="dokter-pp" src="${dokter.ppimg}" alt="Dokter1">
            <div class="dokter-about">
                <div class="dokter-nameetc">
                    <h1>${dokter.nama}</h1>
                    <h3>${dokter.spesialisasi}</h3>
                    <div class="dokter-inform">
                        <div>
                            <img src="../image/icon/briefcase.png" alt="Pengalaman Kerja">
                            <p>${dokter.exp}</p>
                        </div>
                        <div>
                            <img src="../image/icon/Like.png" alt="Feedback++">
                            <p>${dokter.like}</p>
                        </div>
                    </div>
                </div>
                <button onclick="tomboldokter('${dokter.nama}')" class="tomb-doktr">Pilih Dokter</button>
            </div>
            `;
        var jadwalc = document.createElement("div");
        jadwalc.className = "dokter-jadwal";
        jadwalc.innerHTML = jadwalc.innerHTML + `<h3>Jadwal Praktek :</h3>`;
        dokter.jadwal.forEach(function (i) {
            jadwalc.innerHTML = jadwalc.innerHTML + `<p>${i[0]}, ${i[1]}</p>`
        });
        dokterElement.appendChild(jadwalc);
        var allDokterContainer = document.getElementsByClassName("all-dokter-container")[0];
        allDokterContainer.appendChild(dokterElement);
        
        var dokterselect = document.createElement("option");
        dokterselect.value = dokter.nama;
        dokterselect.textContent = dokter.nama;
        var dokterlistselect = document.getElementById("dokterinput");
        dokterlistselect.appendChild(dokterselect);
    });
    
}

function formatDate(date) {
    const options = { year: 'numeric', month: 'long', day: '2-digit' };
    return date.toLocaleDateString('id-ID', options);
}

function formatformDate(inputDate) {
    const date = new Date(inputDate);
    
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    const year = date.getFullYear();

    const formattedDate = `${year}-${month}-${day}`;
    return formattedDate;
}



function getNextDayOfWeek(dayOfWeek) {
    const daysOfWeek = ['minggu', 'senin', 'selasa', 'rabu', 'kamis', 'jumat', 'sabtu'];
    const today = new Date();
    const currentDayOfWeek = today.getDay();
    const targetDayIndex = daysOfWeek.indexOf(dayOfWeek.toLowerCase());
  
    let daysUntilTargetDay = targetDayIndex - currentDayOfWeek;
  
    if (daysUntilTargetDay < 0) {
      daysUntilTargetDay += 7;
    } else if (daysUntilTargetDay === 0) {
      return today;
    }
  
    const nextDate = new Date(today);
    nextDate.setDate(today.getDate() + daysUntilTargetDay);
    return nextDate;
  }

function inputjaddok(poli) {
    var jadwali = document.getElementById("jadwal-input");
    jadwali.innerHTML = "";
    if (!poli) {
        return
    }
    var doktername = document.getElementById("dokterinput").value;
    poliData[poli].forEach(function(x){
        if (x.nama==doktername) {
            var no=1;
            x.jadwal.forEach(function(i){
                var idradio = `radjad${no}`
                var datej = getNextDayOfWeek(i[0]);
                var datex = formatDate(datej);
                jadwali.innerHTML = jadwali.innerHTML + `
                <div><label for="${idradio}">${i[0]}, ${i[1]},<br> ${datex}</label><input type="radio" id="${idradio}" name="jadwal-input" value="${i} ,${datex}"></div>`
                no=no+1;
            });
        }
    })
    if (jadwali.innerHTML != "") {
        var inputpertama = document.getElementById("jadwal-input").children[0].children[1];
        inputpertama.setAttribute("required",true);
    }
};

function tomboldokter(nama){
    var selecteddokter = document.getElementById("dokterinput");
    selecteddokter.value = nama 
    var form = document.getElementById("formdt");
    form.scrollIntoView();
}

document.getElementById("jenis-kelamin").addEventListener("change", function () {
    var jenk = document.getElementById("jenis-kelamin");
    jenk.style.color = "black"
});

window.addEventListener("load",function(){
    var jenk = document.getElementById("jenis-kelamin");
    var dokinp = document.getElementById("dokterinput");
    jenk.value = "none";
    dokinp.value = "none";
    inputjaddok()
})

var poliTerpilih = getParameterByName('poli');
if (poliTerpilih) {
    const titletext = document.getElementById("titletext");
    const formtitletext = document.getElementById("formtitletext");
    titletext.textContent = 'DOKTER '+poliTerpilih.replace('poli','poli ').toUpperCase();
    formtitletext.textContent = 'PENDAFTARAN '+poliTerpilih.replace('poli','poli ').toUpperCase();
    if (poliTerpilih=='polipdalam') {
        titletext.textContent = 'DOKTER PENYAKIT DALAM'
        formtitletext.textContent = 'PENDAFTARAN POLI PENYAKIT DALAM'
    };

    var poliinput = document.getElementById("poliinput");
    poliinput.value = poliTerpilih.replace('poli',' ').toUpperCase();
    tampilkanDokter(poliTerpilih);
    
    var formcont = document.getElementById("formct");
    formcont.style.display = "flex";
    
    inputjaddok(poliTerpilih);
    document.getElementById("dokterinput").addEventListener("change",function () {
        inputjaddok(poliTerpilih)
        document.getElementById("dokterinput").style.color = "black";
        document.getElementById("jadkunj-lab").style.visibility = "visible";
        document.getElementById("jadwal-input").style.visibility = "visible";
    });

    function handleClick() {
        inputjaddok(poliTerpilih);
        document.getElementById("dokterinput").style.color = "black";
        document.getElementById("jadkunj-lab").style.visibility = "visible";
        document.getElementById("jadwal-input").style.visibility = "visible";
    }
    document.querySelectorAll(".tomb-doktr").forEach(function (e) {
        e.addEventListener("click", handleClick);       
    });
    
    var inputTanggal = document.getElementById("tanggallahir");
    var tanggalSaatIni = new Date();
    var tahun = tanggalSaatIni.getFullYear();
    var bulan = (tanggalSaatIni.getMonth() + 1).toString().padStart(2, '0');
    var tanggal = tanggalSaatIni.getDate().toString().padStart(2, '0');
    inputTanggal.setAttribute("max",tahun + "-" + bulan + "-" + tanggal);

    document.getElementById('formdt').addEventListener('submit',function(event) {
        event.preventDefault();
        var jenisk = document.getElementById("jenis-kelamin")
        var dokinp = document.getElementById("dokterinput")
        if (jenisk.value === 'none' && dokinp.value === 'none') {
            alert("Harap Pilih Jenis Kelamin Dan Dokter");
            return;
        }
        else if (jenisk.value === 'none') {
            alert("Harap Pilih Jenis Kelamin");
            return;
        }
        else if (dokinp.value === 'none') {
            alert("Harap Pilih Dokter");
            return;
        }
    
        const nama = document.getElementById('namalengkap').value;
        const tanggalLahir = document.getElementById('tanggallahir').value;
        const jenisKelamin = document.getElementById('jenis-kelamin').value;
        const nomorHP = document.getElementById('nomor-hp').value;
        const email = document.getElementById('emailp').value;
        const nik = document.getElementById('nik').value;
        const statusPasien = document.querySelector('input[name="status-pasien"]:checked').value;
        const poli = document.getElementById('poliinput').value;
        const dokter = document.getElementById('dokterinput').value;
    
        var penilaian = document.querySelector('input[name="jadwal-input"]:checked').value;
        var parts = penilaian.split(',');
        var tanggal = parts[2].trim();
        var tanggalArray = tanggal.split(' ');
        var bulanMap = {
            'Januari': '01',
            'Februari': '02',
            'Maret': '03',
            'April': '04',
            'Mei': '05',
            'Juni': '06',
            'Juli': '07',
            'Agustus': '08',
            'September': '09',
            'Oktober': '10',
            'November': '11',
            'Desember': '12'
        };
        var formattedTanggal = tanggalArray[2] + '-' + bulanMap[tanggalArray[1]] + '-' + tanggalArray[0];
        var jamString = parts[1].trim();
        var jamArray = jamString.split('-');
        var jamAwal = jamArray[0].trim();
        var formattedJamAwal = jamAwal.replace('.', ':') + ':00';
        var formattedDateTime = formattedTanggal + 'T' + formattedJamAwal;

        const formData = {
            "nama_lengkap":nama,
            "tanggal_lahir": tanggalLahir,
            "jenis_kelamin": jenisKelamin,
            "nomor_hp": nomorHP,
            "email":email,
            "nik":nik,
            "status_pasien": statusPasien,
            "poli":poli,
            "dokter":dokter,
            "jadwal_dokter":formattedDateTime
        };
        var loading = document.getElementById("subloading");
        loading.style.display = "flex";
        fetch('https://be-jayapura-26-production.up.railway.app/poli', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        })
        .then(response => response.json())
        .then(data => {
            console.log('Data berhasil dikirim:', data);
            loading.style.display = "none";
            document.getElementById("submit-success").style.display = "flex";
        })
        .catch(error => {
            console.error('Terjadi kesalahan:', error);
            loading.style.display = "none";
            document.getElementById("submit-failed").style.display = "flex";
        });
    });
}
else{
    var err = document.getElementById('maincontent');
    err.classList.add('error');

    var page = document.getElementById('errorpage');
    page.style.display = 'flex';
}

function subsucok() {
    document.getElementById("submit-success").style.display = "none";
    location.reload();
}

function subfailok() {
    document.getElementById("submit-failed").style.display = "none";
}
