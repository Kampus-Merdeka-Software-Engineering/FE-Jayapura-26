var poliData = {
    poliumum: [
        {
            nama: "dr.Rudi Setiawan",
            spesialisasi: "Dokter Umum",
            exp: "5 Tahun",
            like: "90%",
            ppimg: "../image/Dokter Umum/dokter-umum-1.png",
            jadwal: [
                ["Senin", "08.00-12.00"],
                ["Selasa", "08.00-12.00"],
                ["Rabu", "08.00-12.00"],
                ["Kamis", "17.00-21.00"]
            ]
        },
        {
            nama: "dr.Dewi Handayani",
            spesialisasi: "Dokter Umum",
            exp: "3 Tahun",
            like: "98%",
            ppimg: "../image/Dokter Umum/dokter-umum-2.png",
            jadwal: [
                ["Senin", "13.00-17.00"],
                ["Selasa", "13.00-17.00"],
                ["Rabu", "13.00-17.00"],
                ["Jumat", "17.00-21.00"]
            ]
        },
        {
            nama: "dr.Aditya Prabowo",
            spesialisasi: "Dokter Umum",
            exp: "12 Tahun",
            like: "89%",
            ppimg: "../image/Dokter Umum/dokter-umum-3.png",
            jadwal: [
                ["Senin", "17.00-21.00"],
                ["Selasa", "17.00-21.00"],
                ["Rabu", "17.00-21.00"]
            ]
        },
        {
            nama: "dr.Hendra Wijaya",
            spesialisasi: "Dokter Umum",
            exp: "8 Tahun",
            like: "87%",
            ppimg: "../image/Dokter Umum/dokter-umum-4.png",
            jadwal: [
                ["Kamis", "08.00-12.00"],
                ["Jumat", "08.00-12.00"]
            ]
        },
        {
            nama: "dr.Yulia Safitri",
            spesialisasi: "Dokter Umum",
            exp: "10 Tahun",
            like: "89%",
            ppimg: "../image/Dokter Umum/dokter-umum-5.png",
            jadwal: [
                ["Kamis", "13.00-17.00"],
                ["Jumat", "13.00-17.00"]
            ]
        }
    ],
    poligigi: [
        {
            nama: "dr. Budi Prasetyo, Sp.Ort",
            spesialisasi: "Spesialis Ortodonti",
            exp: "5 Tahun",
            like: "85%",
            ppimg: "../image/Dokter spesialis/dokter-gigi-1.png",
            jadwal: [
                ["Senin", "08.00-12.00"],
                ["Selasa", "08.00-12.00"],
                ["Rabu", "08.00-12.00"],
                ["Kamis", "08.00-12.00"],
                ["Jumat", "08.00-12.00"]
            ]
        },
        {
            nama: "dr. Siti Rahayu, Sp.Perio",
            spesialisasi: "Spesialis Periodonti",
            exp: "6 Tahun",
            like: "92%",
            ppimg: "../image/Dokter spesialis/dokter-gigi-2.png",
            jadwal: [
                ["Senin", "13.00-17.00"],
                ["Selasa", "13.00-17.00"],
                ["Rabu", "13.00-17.00"],
                ["Kamis", "13.00-17.00"],
                ["Jumat", "13.00-17.00"]
            ]
        },
        {
            nama: "dr. Andi Wibowo, Sp.Pros",
            spesialisasi: "Spesialis Prostodonti",
            exp: "12 Tahun",
            like: "98%",
            ppimg: "../image/Dokter spesialis/dokter-gigi-3.png",
            jadwal: [
                ["Senin", "17.00-21.00"],
                ["Selasa", "17.00-21.00"],
                ["Rabu", "17.00-21.00"],
                ["Kamis", "17.00-21.00"],
                ["Jumat", "17.00-21.00"]
            ]
        }
    ],
    polianak: [
        {
            nama: "dr. Anisa Indriani, Sp.A",
            spesialisasi: "Spesialis Anak",
            exp: "4 Tahun",
            like: "95%",
            ppimg: "../image/Dokter spesialis/dokter-anak-1.png",
            jadwal: [
                ["Senin", "08.00-12.00"],
                ["Selasa", "08.00-12.00"],
                ["Rabu", "08.00-12.00"],
                ["Kamis", "08.00-12.00"],
                ["Jumat", "08.00-12.00"]
            ]
        },
        {
            nama: "dr. Dian Purnama, Sp.KJ",
            spesialisasi: "Spesialis Kesehatan Jiwa",
            exp: "7 Tahun",
            like: "90%",
            ppimg: "../image/Dokter spesialis/dokter-anak-2.png",
            jadwal: [
                ["Senin", "13.00-17.00"],
                ["Selasa", "13.00-17.00"],
                ["Rabu", "13.00-17.00"],
                ["Kamis", "13.00-17.00"],
                ["Jumat", "13.00-17.00"]
            ]
        },
        {
            nama: "dr. Rini Cahyati, Sp.THT-KL",
            spesialisasi: "Spesialis Telinga Hidung Tenggorokan-Kepala Leher",
            exp: "5 Tahun",
            like: "93%",
            ppimg: "../image/Dokter spesialis/dokter-anak-3.png",
            jadwal: [
                ["Senin", "17.00-21.00"],
                ["Selasa", "17.00-21.00"],
                ["Rabu", "17.00-21.00"],
                ["Kamis", "17.00-21.00"],
                ["Jumat", "17.00-21.00"]
            ]
        }
    ],
    polipdalam: [
        {
            nama: "dr. Tri Haryanto, Sp.PD",
            spesialisasi: "Spesialis Penyakit Dalam",
            exp: "9 Tahun",
            like: "96%",
            ppimg: "../image/Dokter spesialis/dokter-penyakitdalam-1.png",
            jadwal: [
                ["Senin", "08.00-12.00"],
                ["Selasa", "08.00-12.00"],
                ["Rabu", "08.00-12.00"],
                ["Kamis", "08.00-12.00"],
                ["Jumat", "08.00-12.00"]
            ]
        },
        {
            nama: "dr. Rina Wijaya, Sp.GK",
            spesialisasi: "Spesialis Gizi Klinis",
            exp: "12 Tahun",
            like: "94%",
            ppimg: "../image/Dokter spesialis/dokter-penyakitdalam-2.png",
            jadwal: [
                ["Senin", "13.00-17.00"],
                ["Selasa", "13.00-17.00"],
                ["Rabu", "13.00-17.00"],
                ["Kamis", "13.00-17.00"],
                ["Jumat", "13.00-17.00"]
            ]
        },
        {
            nama: "dr. Siti Rahmawati, Sp.PD",
            spesialisasi: "Spesialis Penyakit Dalam",
            exp: "5 Tahun",
            like: "88%",
            ppimg: "../image/Dokter spesialis/dokter-penyakitdalam-3.png",
            jadwal: [
                ["Senin", "17.00-21.00"],
                ["Selasa", "17.00-21.00"],
                ["Rabu", "17.00-21.00"],
                ["Kamis", "17.00-21.00"],
                ["Jumat", "17.00-21.00"]
            ]
        }
    ],
    polimata: [
        {
            nama: "dr. Adi Nugraha, Sp.M",
            spesialisasi: "Spesialis Mata",
            exp: "9 Tahun",
            like: "87%",
            ppimg: "../image/Dokter spesialis/dokter-mata-1.png",
            jadwal: [
                ["Senin", "08.00-12.00"],
                ["Selasa", "08.00-12.00"],
                ["Rabu", "08.00-12.00"],
                ["Kamis", "08.00-12.00"],
                ["Jumat", "08.00-12.00"]
            ]
        },
        {
            nama: "dr. Maya Dewi, Sp.PA",
            spesialisasi: "Spesialis Patologi Anatomi",
            exp: "7 Tahun",
            like: "90%",
            ppimg: "../image/Dokter spesialis/dokter-mata-2.png",
            jadwal: [
                ["Senin", "13.00-17.00"],
                ["Selasa", "13.00-17.00"],
                ["Rabu", "13.00-17.00"],
                ["Kamis", "13.00-17.00"],
                ["Jumat", "13.00-17.00"]
            ]
        },
        {
            nama: "dr. Iwan Setiawan, Sp.M",
            spesialisasi: "Spesialis Mata",
            exp: "15 Tahun",
            like: "98%",
            ppimg: "../image/Dokter spesialis/dokter-mata-3.png",
            jadwal: [
                ["Senin", "17.00-21.00"],
                ["Selasa", "17.00-21.00"],
                ["Rabu", "17.00-21.00"],
                ["Kamis", "17.00-21.00"],
                ["Jumat", "17.00-21.00"]
            ]
        }
    ],
    polijantung: [
        {
            nama: "dr. Agus Santoso, Sp.JP",
            spesialisasi: "Spesialis Jantung dan Pembuluh Darah",
            exp: "22 Tahun",
            like: "94%",
            ppimg: "../image/Dokter spesialis/dokter-jantung-1.png",
            jadwal: [
                ["Senin", "08.00-12.00"],
                ["Selasa", "08.00-12.00"],
                ["Rabu", "08.00-12.00"],
                ["Kamis", "08.00-12.00"],
                ["Jumat", "08.00-12.00"]
            ]
        },
        {
            nama: "dr. Indah Wulandari, Sp.JP",
            spesialisasi: "Spesialis Jantung dan Pembuluh Darah",
            exp: "13 Tahun",
            like: "95%",
            ppimg: "../image/Dokter spesialis/dokter-jantung-2.png",
            jadwal: [
                ["Senin", "13.00-17.00"],
                ["Selasa", "13.00-17.00"],
                ["Rabu", "13.00-17.00"],
                ["Kamis", "13.00-17.00"],
                ["Jumat", "13.00-17.00"]
            ]
        },
        {
            nama: "dr. Yudi Pranata, Sp.BP",
            spesialisasi: "Spesialis Bedah Jantung dan Pembuluh Darah",
            exp: "18 Tahun",
            like: "98%",
            ppimg: "../image/Dokter spesialis/dokter-jantung-3.png",
            jadwal: [
                ["Senin", "17.00-21.00"],
                ["Selasa", "17.00-21.00"],
                ["Rabu", "17.00-21.00"],
                ["Kamis", "17.00-21.00"],
                ["Jumat", "17.00-21.00"]
            ]
        }
    ]
};


function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
    results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
}

function tampilkanDokter(poliId) {
    poliData[poliId].forEach(function(dokter) {
        var dokterElement = document.createElement("div");
        dokterElement.className = "dokter-container";
        dokterElement.innerHTML = `
            <img id="dokter-pp" src="${dokter.ppimg}" alt="Dokter1">
            <div class="dokter-about">
                <div class="dokter-nameetc">
                    <h1>${dokter.nama}</h1>
                    <h3>${dokter.spesialisasi}</h3>
                    <div class="dokter-inform">
                        <div>
                            <img src="../image/icon/briefcase.png" alt="Pengalaman Kerja">
                            <p>${dokter.exp}</p>
                        </div>
                        <div>
                            <img src="../image/icon/Like.png" alt="Feedback++">
                            <p>${dokter.like}</p>
                        </div>
                    </div>
                </div>
                <button onclick="tomboldokter('${dokter.nama}')">Pilih Dokter</button>
            </div>
            `;
        var jadwalc = document.createElement("div");
        jadwalc.className = "dokter-jadwal";
        jadwalc.innerHTML = jadwalc.innerHTML + `<h3>Jadwal Praktek :</h3><br>`;
        dokter.jadwal.forEach(function (i) {
            jadwalc.innerHTML = jadwalc.innerHTML + `<p class="jadwal-text">${i[0]}, ${i[1]}</p>`
        });
        dokterElement.appendChild(jadwalc);
        var allDokterContainer = document.getElementsByClassName("all-dokter-container")[0];
        allDokterContainer.appendChild(dokterElement);
        
        var dokterselect = document.createElement("option");
        dokterselect.value = dokter.nama;
        dokterselect.textContent = dokter.nama;
        var dokterlistselect = document.getElementById("dokterinput");
        dokterlistselect.appendChild(dokterselect);
    });
    
}

function formatDate(date) {
    const options = { year: 'numeric', month: 'long', day: '2-digit' };
    return date.toLocaleDateString('id-ID', options);
}

function formatformDate(inputDate) {
    const date = new Date(inputDate);
    
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    const year = date.getFullYear();

    const formattedDate = `${year}-${month}-${day}`;
    return formattedDate;
}



function getNextDayOfWeek(dayOfWeek) {
    const daysOfWeek = ['minggu', 'senin', 'selasa', 'rabu', 'kamis', 'jumat', 'sabtu'];
    const today = new Date();
    const currentDayOfWeek = today.getDay();
    const targetDayIndex = daysOfWeek.indexOf(dayOfWeek.toLowerCase());
  
    let daysUntilTargetDay = targetDayIndex - currentDayOfWeek;
  
    if (daysUntilTargetDay < 0) {
      daysUntilTargetDay += 7;
    } else if (daysUntilTargetDay === 0) {
      return today;
    }
  
    const nextDate = new Date(today);
    nextDate.setDate(today.getDate() + daysUntilTargetDay);
    return nextDate;
  }

function inputjaddok(poli) {
    console.log(poli)
    var jadwali = document.getElementById("jadwal-input");
    jadwali.innerHTML = "";
    var doktername = document.getElementById("dokterinput").value;
    poliData[poli].forEach(function(x){
        if (x.nama==doktername) {
            console.log(x.nama +" : "+x.jadwal)
            var no=1;
            x.jadwal.forEach(function(i){
                var idradio = `radjad${no}`
                var datej = getNextDayOfWeek(i[0]);
                var datex = formatDate(datej);
                jadwali.innerHTML = jadwali.innerHTML + `
                <div><label for="${idradio}">${i[0]}, ${i[1]},<br> ${datex}</label><input type="radio" id="${idradio}" name="jadwal-input" value=${i} onclick="getRadioValue('${datej}')"></div>`
                no=no+1;
            });
        }
    })
    var inputpertama = document.getElementById("jadwal-input").children[0].children[1];
    inputpertama.setAttribute("required",true)
    ;
};

function getRadioValue(date){
    var tglknj = document.getElementById("tgl-kunj");
    tglknj.value = formatformDate(date)
};

function tomboldokter(nama){
    var selecteddokter = document.getElementById("dokterinput");
    selecteddokter.value = nama 
    var form = document.getElementById("formdt");
    form.scrollIntoView();
}

document.querySelector("form").addEventListener("submit", function (event) {
    event.preventDefault();
    var jenisk = document.getElementById("jenis-kelamin")

  
    if (jenisk.value === 'none') {
        alert("Harap Pilih Jenis Kelamin");
        return;
    }
    this.submit(); 
});

document.getElementById("jenis-kelamin").addEventListener("change", function () {
    var jenk = document.getElementById("jenis-kelamin");
    jenk.style.color = "black"
});

window.addEventListener("load",function(){
    var jenk = document.getElementById("jenis-kelamin");
    jenk.value = "none";
})

var poliTerpilih = getParameterByName('poli');
if (poliTerpilih) {
    const titletext = document.getElementById("titletext");
    const formtitletext = document.getElementById("formtitletext");
    titletext.textContent = 'DOKTER '+poliTerpilih.replace('poli','poli ').toUpperCase();
    formtitletext.textContent = 'PENDAFTARAN '+poliTerpilih.replace('poli','poli ').toUpperCase();
    if (poliTerpilih=='polipdalam') {
        titletext.textContent = 'DOKTER PENYAKIT DALAM'
        formtitletext.textContent = 'PENDAFTARAN POLI PENYAKIT DALAM'
    };

    var poliinput = document.getElementById("poliinput");
    poliinput.value = poliTerpilih.replace('poli',' ').toUpperCase();
    tampilkanDokter(poliTerpilih);
    
    var formcont = document.getElementById("formct");
    formcont.style.display = "flex";
    
    inputjaddok(poliTerpilih);
    document.getElementById("dokterinput").addEventListener("change",function () {
        inputjaddok(poliTerpilih)
    });
    var inputTanggal = document.getElementById("tanggallahir");
    var tanggalSaatIni = new Date();
    var tahun = tanggalSaatIni.getFullYear();
    var bulan = (tanggalSaatIni.getMonth() + 1).toString().padStart(2, '0');
    var tanggal = tanggalSaatIni.getDate().toString().padStart(2, '0');
    inputTanggal.setAttribute("max",tahun + "-" + bulan + "-" + tanggal);
}
else{
    var err = document.getElementById('maincontent');
    err.classList.add('error');

    var page = document.getElementById('errorpage');
    page.style.display = 'flex';
}